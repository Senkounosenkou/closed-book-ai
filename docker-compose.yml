services:
  closedbook-app:
    # 1. 開発中は「build」を使うことで、手元のDockerfile（requirements.txt更新済み）を反映させる
    build: .
    # 公開用イメージ名も書いておくと、build時にこの名前でタグが付く
    image: senkounosenkou/closed-book-ai:v1.2
    container_name: closedbook-app
    # プロキシを通さず直接Streamlitを起動
    command: streamlit run main.py --server.address 0.0.0.0
    ports:
      - "8501:8501"
    volumes:
      # 2. ここがポイント！手元のコードをコンテナに同期
      - ./app:/app
      - ./data:/data
      - ./storage:/app/storage
      - ./.streamlit:/app/.streamlit
      - ./app/config.yaml:/app/config.yaml
    networks:
      - ollama_default
    restart: always

networks:
  ollama_default:
    # 既存のOllamaネットワークに相乗りする設定
    external: true
